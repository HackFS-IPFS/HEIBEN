(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-744e95cb"],{"20e2":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("div",{staticClass:"filter-container"},[a("el-input",{staticClass:"filter-item",staticStyle:{width:"200px"},attrs:{placeholder:"Product ID"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.runGetData(t)}},model:{value:e.idToSearch,callback:function(t){e.idToSearch=t},expression:"idToSearch"}}),a("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.runGetData}},[e._v("Search")]),a("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-s-data"},on:{click:e.showTraceChart}},[e._v("查看图示")])],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],key:e.tableKey,staticStyle:{width:"100%"},attrs:{"span-method":e.arraySpanMethod,data:e.list,border:"",fit:"","highlight-current-row":""}},[a("el-table-column",{attrs:{label:"产品编号",prop:"id",sortable:"custom",align:"center",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("span",[e._v(e._s(n.productID))])]}}])}),a("el-table-column",{attrs:{label:"生产日期",width:"150px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("span",[e._v(e._s(n.productionDate))])]}}])}),a("el-table-column",{attrs:{label:"产品名称","min-width":"150px"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("span",[e._v(e._s(n.productName))])]}}])}),a("el-table-column",{attrs:{label:"加工厂商","min-width":"150px"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("span",[e._v(e._s(n.companyName))])]}}])}),a("el-table-column",{attrs:{label:"原材料编号","min-width":"150px"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("span",[e._v(e._s(n.materialID))])]}}])})],1),a("el-dialog",{attrs:{visible:e.dialogVisible,width:"90%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("trace-chart-component",{ref:"traceChart",attrs:{data:e.rawList,rootid:e.rootID}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("确 定")])],1)],1)],1)},o=[],i=(a("4160"),a("13d5"),a("d3b7"),a("6062"),a("3ca3"),a("159b"),a("ddb0"),a("96cf"),a("1da1")),r=a("89ff"),l=a("6724"),s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"trace-chart-container"},[a("div",{style:{width:"100%",height:"100%"},attrs:{id:"trace-chart"}})])},c=[],d=(a("fb6a"),a("b0c0"),a("4ec9"),a("313e")),u=a.n(d),h={name:"TraceChartComponent",props:{data:{type:Array,required:!0},rootid:{type:String,required:!0}},data:function(){return{graph:{nodes:[],links:[]},nameDataMap:{}}},mounted:function(){console.log("trace-chart-container mounted"),this.runRender()},beforeUpdate:function(){console.log("trace-chart-container before update")},updated:function(){console.log("trace-chart-container updated")},methods:{runRender:function(){if(!this.data)return!1;this.graph={nodes:[],links:[]},this.nameDataMap={},this.prepareData(),this.convertData(),this.drawLine()},drawLine:function(){console.log("drawline started");var e=u.a.init(document.getElementById("trace-chart")),t={xAxis:{show:!1,type:"value"},yAxis:{show:!1,type:"value"},tooltip:{trigger:"item",formatter:function(e){var t="";return t+="<p>名称："+e.data.productName+"<p>",t+="<p>生产公司："+e.data.companyName+"<p>",t+="<p>生产日期："+e.data.productionDate+"<p>",t}},series:[{type:"graph",layout:"none",zoom:.9,focusNodeAdjacency:!0,roam:!0,hoverAnimation:!0,animationDuration:1500,animationEasingUpdate:"quinticInOut",symbolSize:150,label:{show:!0,position:"inside",formatter:function(e){var t="";t+="{titleName|商品ID}\n",t+="{title|"+e.data.name+"}\n",t+="{titleName|名称}\n";var a=e.data.productName,n=0;t+="{title|";while(a.length>10)t+=a.slice(0,10),t+="\n",n++,a=a.slice(10*n,a.length);return t+=a,t+="}\n",t},rich:{titleName:{fontSize:14,height:16,color:"#fff",align:"center"},title:{height:25,fontSize:16,fontStyle:"bold",color:"#fff",align:"center"},contentName:{height:16,fontSize:14,color:"#fff",align:"left",padding:[0,40,0,0]},content:{height:16,fontSize:14,color:"#fff",align:"left"},hr:{borderColor:"#f2f2f2",width:"100%",borderWidth:.5,height:0}}},itemStyle:{color:"#101010",borderColor:"#fff",borderWidth:1,shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.3)"},edgeSymbol:["circle","arrow"],edgeSymbolSize:30,lineStyle:{width:4,shadowColor:"none",color:"source",curveness:.3},emphasis:{lineStyle:{width:10},label:{show:!1}},data:this.graph.nodes,links:this.graph.links}]};e.setOption(t),console.log("drawline ended")},prepareData:function(){var e=this;console.log("prepareData() started"),this.nameDataMap=new Map,this.data.forEach((function(t){if(e.nameDataMap.has(t.productID))return!0;e.nameDataMap.set(t.productID,t)})),console.log("prepareData() finished")},convertData:function(){var e=this;console.log("convertData() started");var t=[],a=new Set,n=new Map,o=new Map,i=!0;t.push(this.rootid),console.log("this.rootid = ",this.rootid);var r=function(){console.log("===== entering new level =====");var r=t[0];if(console.log("-- new item --"),console.log("itemName = ",r),a.has(r))return console.log("havingRetrieved.length = ",a.size),console.log("has item, itemName = ",r),console.log("waitingRetrieve[0] = ",t[0]),t.shift(),console.log("waitingRetrieve[0] = ",t[0]),"continue";var l=e.nameDataMap.get(r);l.name=l.productID,!0===i?(l.x=0,l.y=0):(l.x=o.get(r)[0],l.y=o.get(r)[1]),e.graph.nodes.push(l),a.add(r),t.shift(),console.log("- after retrieving -"),console.log("item.materialsID.length = ",l.materialsID.length),l.materialsID.forEach((function(a){t.push(a),console.log("add to waitingRetrieve, itemName2 = ",a);var i={source:r,target:a};if(e.graph.links.push(i),!1===o.has(a)){var s=n.get(l.x);void 0===s&&(s=0),o.set(a,[l.x-1,s]),n.set(l.x,s+1)}})),i=!1,console.log("waitingRetrieve.length = ",t.length)};while(t.length>0)r();console.log("convertData() finished")}}},p=h,m=(a("29ad"),a("2877")),g=Object(m["a"])(p,s,c,!1,null,"1f4ed767",null),f=g.exports,v=[{key:"CN",display_name:"China"},{key:"US",display_name:"USA"},{key:"JP",display_name:"Japan"},{key:"EU",display_name:"Eurozone"}],w=v.reduce((function(e,t){return e[t.key]=t.display_name,e}),{}),y={name:"ComplexTable",components:{TraceChartComponent:f},directives:{waves:l["a"]},filters:{statusFilter:function(e){var t={published:"success",draft:"info",deleted:"danger"};return t[e]},typeFilter:function(e){return w[e]}},data:function(){return{idToSearch:"",tableKey:0,hasRendered:!1,rootID:"",dialogVisible:!1,list:null,rawList:null,total:0,listLoading:!1,listQuery:{page:1,limit:20,importance:void 0,title:void 0,type:void 0,sort:"+id"},importanceOptions:[1,2,3],calendarTypeOptions:v,sortOptions:[{label:"ID Ascending",key:"+id"},{label:"ID Descending",key:"-id"}],statusOptions:["published","draft","deleted"],showReviewer:!1,temp:{id:void 0,importance:1,remark:"",timestamp:new Date,title:"",type:"",status:"published"},dialogFormVisible:!1,dialogStatus:"",textMap:{update:"Edit",create:"Create"},dialogPvVisible:!1,pvData:[],rules:{type:[{required:!0,message:"type is required",trigger:"change"}],timestamp:[{type:"date",required:!0,message:"timestamp is required",trigger:"change"}],title:[{required:!0,message:"title is required",trigger:"blur"}]},downloadLoading:!1}},mounted:function(){},methods:{runGetData:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.hasRendered=!1,e.rootID=e.idToSearch,console.log(e.idToSearch),t.next=5,e.getData(e.rootID);case 5:case"end":return t.stop()}}),t)})))()},getData:function(e){var t=this;this.listLoading=!0,Object(r["b"])(e).then((function(e){if(t.listLoading=!1,console.log("response =",e),console.log(e[0]),console.log(e[0].productName),1===e.length&&void 0===e[0].productName)return t.list=null,!0;t.list=e,console.log("this.list",t.list),t.prepareData()}))},prepareData:function(){console.log("开始去重");var e=new Set,t=[],a=this.list;console.log("this.list = ",a),this.list.forEach((function(a){if(console.log("item.productID = ",a.productID),console.log("item.productName = ",a.productName),console.log("item.materialsID.length = ",a.materialsID.length),e.has(a.productID))return console.log("has item skip"),!0;console.log("add item"),e.add(a.productID),t.push(a),console.log("add item completed")})),console.log("partly complete, hasItem = ",e);var n=t;this.rawList=n,console.log("去重完成"),console.log("rawList = ",n);for(var o=0;o<n.length;o++)n[o].productionDate=n[o].productionDate.substr(0,10);var i,r=[];n.forEach((function(e){0===e.materialsID.length?(console.log("item.materialsID.length === 0, item = ",e),i=JSON.parse(JSON.stringify(e)),i.materialID=null,r.push(i)):e.materialsID.length>=1&&(console.log("item.materialsID.length =",e.materialsID.length,"item = ",e),e.materialsID.forEach((function(t){i=JSON.parse(JSON.stringify(e)),i.materialID=t,r.push(i),console.log("materialID = ",t),console.log("newItem.materialID = ",i.materialID),console.log("newList[newList.length - 1].materialID = ",r[r.length-1].materialID)})))})),console.log("newList = ",r),this.list=r},arraySpanMethod:function(e){var t=e.row,a=(e.column,e.rowIndex,e.columnIndex);if(a<4&&t.materialsID.length>1)return t.materialsID[0]===t.materialID?[t.materialsID.length,1]:[0,0]},showTraceChart:function(){return void 0===this.list||null===this.list||0===this.list.length?(this.$message.error("缺少数据"),!1):(this.dialogVisible=!0,!0===this.hasRendered?(console.log("this.hasRendered = ",this.hasRendered),console.log("this.list = ",this.list),console.log("this.list.length = ",this.list.length),!1):(console.log(this.$refs.traceChart),this.$refs.traceChart&&this.$refs.traceChart.runRender(),void(this.hasRendered=!0)))}}},b=y,D=Object(m["a"])(b,n,o,!1,null,null,null);t["default"]=D.exports},"29ad":function(e,t,a){"use strict";var n=a("4518"),o=a.n(n);o.a},4518:function(e,t,a){},6724:function(e,t,a){"use strict";a("8d41");var n="@@wavesContext";function o(e,t){function a(a){var n=Object.assign({},t.value),o=Object.assign({ele:e,type:"hit",color:"rgba(0, 0, 0, 0.15)"},n),i=o.ele;if(i){i.style.position="relative",i.style.overflow="hidden";var r=i.getBoundingClientRect(),l=i.querySelector(".waves-ripple");switch(l?l.className="waves-ripple":(l=document.createElement("span"),l.className="waves-ripple",l.style.height=l.style.width=Math.max(r.width,r.height)+"px",i.appendChild(l)),o.type){case"center":l.style.top=r.height/2-l.offsetHeight/2+"px",l.style.left=r.width/2-l.offsetWidth/2+"px";break;default:l.style.top=(a.pageY-r.top-l.offsetHeight/2-document.documentElement.scrollTop||document.body.scrollTop)+"px",l.style.left=(a.pageX-r.left-l.offsetWidth/2-document.documentElement.scrollLeft||document.body.scrollLeft)+"px"}return l.style.backgroundColor=o.color,l.className="waves-ripple z-active",!1}}return e[n]?e[n].removeHandle=a:e[n]={removeHandle:a},a}var i={bind:function(e,t){e.addEventListener("click",o(e,t),!1)},update:function(e,t){e.removeEventListener("click",e[n].removeHandle,!1),e.addEventListener("click",o(e,t),!1)},unbind:function(e){e.removeEventListener("click",e[n].removeHandle,!1),e[n]=null,delete e[n]}},r=function(e){e.directive("waves",i)};window.Vue&&(window.waves=i,Vue.use(r)),i.install=r;t["a"]=i},"89ff":function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"a",(function(){return i}));var n=a("b775");function o(e){return Object(n["a"])({url:"/api/trace/",method:"GET",params:{productID:e}})}function i(e){return Object(n["a"])({url:"/api/add/",method:"POST",data:e})}},"8d41":function(e,t,a){}}]);